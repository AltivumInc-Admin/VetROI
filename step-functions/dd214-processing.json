{
    "stateMachineArn": "arn:aws:states:us-east-2:205930636302:stateMachine:VetROI-DD214-Processing",
    "name": "VetROI-DD214-Processing",
    "status": "ACTIVE",
    "definition": "{\n  \"Comment\": \"Complete DD214 processing workflow with insights generation\",\n  \"StartAt\": \"StartTextractJob\",\n  \"States\": {\n    \"StartTextractJob\": {\n      \"Type\": \"Task\",\n      \"Resource\": \"arn:aws:states:::aws-sdk:textract:startDocumentTextDetection\",\n      \"Parameters\": {\n        \"DocumentLocation\": {\n          \"S3Object\": {\n            \"Bucket.$\": \"$.bucket\",\n            \"Name.$\": \"$.key\"\n          }\n        }\n      },\n      \"ResultPath\": \"$.textractJob\",\n      \"Next\": \"WaitForTextract\"\n    },\n    \"WaitForTextract\": {\n      \"Type\": \"Wait\",\n      \"Seconds\": 10,\n      \"Next\": \"GetTextractResults\"\n    },\n    \"GetTextractResults\": {\n      \"Type\": \"Task\",\n      \"Resource\": \"arn:aws:states:::aws-sdk:textract:getDocumentTextDetection\",\n      \"Parameters\": {\n        \"JobId.$\": \"$.textractJob.JobId\",\n        \"MaxResults\": 1\n      },\n      \"ResultPath\": \"$.textractStatus\",\n      \"ResultSelector\": {\n        \"JobStatus.$\": \"$.JobStatus\"\n      },\n      \"Next\": \"CheckTextractStatus\"\n    },\n    \"CheckTextractStatus\": {\n      \"Type\": \"Choice\",\n      \"Choices\": [\n        {\n          \"Variable\": \"$.textractStatus.JobStatus\",\n          \"StringEquals\": \"SUCCEEDED\",\n          \"Next\": \"ProcessTextractResults\"\n        },\n        {\n          \"Variable\": \"$.textractStatus.JobStatus\",\n          \"StringEquals\": \"FAILED\",\n          \"Next\": \"ProcessingFailed\"\n        }\n      ],\n      \"Default\": \"WaitForTextract\"\n    },\n    \"ProcessTextractResults\": {\n      \"Type\": \"Task\",\n      \"Resource\": \"arn:aws:lambda:us-east-2:205930636302:function:VetROI_DD214_Processor\",\n      \"Parameters\": {\n        \"stepType\": \"textract_complete\",\n        \"documentId.$\": \"$.documentId\",\n        \"textractJobId.$\": \"$.textractJob.JobId\",\n        \"bucket.$\": \"$.bucket\",\n        \"key.$\": \"$.key\"\n      },\n      \"ResultPath\": \"$.processedData\",\n      \"Next\": \"StartMacieScan\"\n    },\n    \"StartMacieScan\": {\n      \"Type\": \"Task\",\n      \"Resource\": \"arn:aws:lambda:us-east-2:205930636302:function:VetROI_DD214_Macie\",\n      \"Parameters\": {\n        \"operation\": \"scan\",\n        \"documentId.$\": \"$.documentId\",\n        \"bucket.$\": \"$.bucket\",\n        \"key.$\": \"$.key\"\n      },\n      \"ResultPath\": \"$.macieJob\",\n      \"Next\": \"WaitForMacie\",\n      \"Retry\": [\n        {\n          \"ErrorEquals\": [\n            \"States.TaskFailed\"\n          ],\n          \"IntervalSeconds\": 2,\n          \"MaxAttempts\": 3,\n          \"BackoffRate\": 2\n        }\n      ]\n    },\n    \"WaitForMacie\": {\n      \"Type\": \"Wait\",\n      \"Seconds\": 15,\n      \"Next\": \"CheckMacieFindings\"\n    },\n    \"CheckMacieFindings\": {\n      \"Type\": \"Task\",\n      \"Resource\": \"arn:aws:lambda:us-east-2:205930636302:function:VetROI_DD214_Macie\",\n      \"Parameters\": {\n        \"operation\": \"process_findings\",\n        \"macieJobId.$\": \"$.macieJob.macieJobId\",\n        \"documentId.$\": \"$.documentId\"\n      },\n      \"ResultPath\": \"$.macieFindings\",\n      \"Next\": \"IsMacieComplete\"\n    },\n    \"IsMacieComplete\": {\n      \"Type\": \"Choice\",\n      \"Choices\": [\n        {\n          \"Variable\": \"$.macieFindings.status\",\n          \"StringEquals\": \"processing\",\n          \"Next\": \"WaitForMacie\"\n        },\n        {\n          \"Variable\": \"$.macieFindings.requiresRedaction\",\n          \"BooleanEquals\": true,\n          \"Next\": \"RedactDocument\"\n        }\n      ],\n      \"Default\": \"GenerateInsights\"\n    },\n    \"RedactDocument\": {\n      \"Type\": \"Task\",\n      \"Resource\": \"arn:aws:lambda:us-east-2:205930636302:function:VetROI_DD214_Macie\",\n      \"Parameters\": {\n        \"operation\": \"redact\",\n        \"documentId.$\": \"$.documentId\",\n        \"findings.$\": \"$.macieFindings.findings\",\n        \"extractedText.$\": \"$.processedData.extractedText\"\n      },\n      \"ResultPath\": \"$.redactionResult\",\n      \"Next\": \"GenerateInsights\"\n    },\n    \"GenerateInsights\": {\n      \"Type\": \"Task\",\n      \"Resource\": \"arn:aws:lambda:us-east-2:205930636302:function:VetROI_DD214_Insights\",\n      \"Parameters\": {\n        \"documentId.$\": \"$.documentId\",\n        \"extractedData.$\": \"$.processedData.extractedFields\",\n        \"extractedText.$\": \"$.processedData.extractedText\"\n      },\n      \"ResultPath\": \"$.insightsResult\",\n      \"Next\": \"UpdateDynamoDB\",\n      \"Retry\": [\n        {\n          \"ErrorEquals\": [\n            \"States.TaskFailed\"\n          ],\n          \"IntervalSeconds\": 5,\n          \"MaxAttempts\": 2,\n          \"BackoffRate\": 2\n        }\n      ]\n    },\n    \"UpdateDynamoDB\": {\n      \"Type\": \"Task\",\n      \"Resource\": \"arn:aws:states:::dynamodb:updateItem\",\n      \"Parameters\": {\n        \"TableName\": \"VetROI_DD214_Processing\",\n        \"Key\": {\n          \"document_id\": {\n            \"S.$\": \"$.documentId\"\n          }\n        },\n        \"UpdateExpression\": \"SET #status = :status, #processed = :processed, #updated = :updated, #complete = :complete\",\n        \"ExpressionAttributeNames\": {\n          \"#status\": \"status\",\n          \"#processed\": \"extracted_fields\",\n          \"#updated\": \"updated_at\",\n          \"#complete\": \"processing_complete\"\n        },\n        \"ExpressionAttributeValues\": {\n          \":status\": {\n            \"S\": \"complete\"\n          },\n          \":processed\": {\n            \"S.$\": \"States.JsonToString($.processedData.extractedFields)\"\n          },\n          \":updated\": {\n            \"S.$\": \"$$.State.EnteredTime\"\n          },\n          \":complete\": {\n            \"BOOL\": true\n          }\n        }\n      },\n      \"ResultPath\": \"$.updateResult\",\n      \"Next\": \"ProcessingComplete\"\n    },\n    \"ProcessingComplete\": {\n      \"Type\": \"Succeed\"\n    },\n    \"ProcessingFailed\": {\n      \"Type\": \"Fail\",\n      \"Error\": \"ProcessingFailed\",\n      \"Cause\": \"DD214 processing pipeline failed\"\n    }\n  }\n}\n",
    "roleArn": "arn:aws:iam::205930636302:role/VetROI-StepFunctions-ExecutionRole",
    "type": "STANDARD",
    "creationDate": "2025-06-16T21:54:26.670000-05:00",
    "loggingConfiguration": {
        "level": "OFF",
        "includeExecutionData": false
    },
    "tracingConfiguration": {
        "enabled": true
    },
    "revisionId": "e2094b8d-86af-4446-bb9a-cde458b4729e",
    "encryptionConfiguration": {
        "type": "AWS_OWNED_KEY"
    }
}
